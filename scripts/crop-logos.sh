#!/bin/bash
set -e

# –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–µ–∑–∫–∞ –ª–æ–≥–æ—Ç–∏–ø–æ–≤ WolfGuard –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
# –£–±–∏—Ä–∞–µ–º –ø—É—Å—Ç–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ —Ä–∏—Å—É–Ω–æ–∫ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PUBLIC_DIR="$SCRIPT_DIR/public"

cd "$PUBLIC_DIR"

echo "‚úÇÔ∏è  –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–µ–∑–∫–∞ –ª–æ–≥–æ—Ç–∏–ø–æ–≤ WolfGuard..."
echo ""

# –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–µ–∑–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ª–æ–≥–æ—Ç–∏–ø–∞
for i in 1 2 3; do
    INPUT="logo-$i.png"

    if [ ! -f "$INPUT" ]; then
        echo "‚ùå $INPUT not found"
        continue
    fi

    echo "üìê –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é $INPUT..."

    # 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–µ–∑–∫–∞ —Å —É—á–µ—Ç–æ–º —Ç–µ–º–Ω–æ–≥–æ —Ñ–æ–Ω–∞ –∏ —Å–≤–µ—á–µ–Ω–∏—è
    # -fuzz 15% - —É—á–∏—Ç—ã–≤–∞–µ—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –∏ —Å–≤–µ—á–µ–Ω–∏–µ –≤–æ–∫—Ä—É–≥ –æ–±—ä–µ–∫—Ç–æ–≤
    # -trim - –æ–±—Ä–µ–∑–∞–µ—Ç –ø—É—Å—Ç–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
    # +repage - —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π canvas
    CROPPED="logo-$i-cropped.png"
    magick "$INPUT" -fuzz 15% -trim +repage "$CROPPED"

    # –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –ø–æ—Å–ª–µ –æ–±—Ä–µ–∑–∫–∏
    DIMS=$(magick identify -format "%wx%h" "$CROPPED")
    echo "   –†–∞–∑–º–µ—Ä –ø–æ—Å–ª–µ –æ–±—Ä–µ–∑–∫–∏: $DIMS"

    # 2. –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à–∏–µ –æ—Ç—Å—Ç—É–ø—ã (2% –æ—Ç —Ä–∞–∑–º–µ—Ä–∞) –¥–ª—è —ç—Å—Ç–µ—Ç–∏–∫–∏
    PADDED="logo-$i-padded.png"
    magick "$CROPPED" -bordercolor none -border 2%x2% "$PADDED"

    DIMS_PADDED=$(magick identify -format "%wx%h" "$PADDED")
    echo "   –†–∞–∑–º–µ—Ä —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏: $DIMS_PADDED"

    # 3. –°–æ–∑–¥–∞–µ–º –≤–µ—Ä—Å–∏–∏ —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –∏–∑ –æ–±—Ä–µ–∑–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞

    # –î–ª—è –∏–∫–æ–Ω–∫–∏ (—Ç–æ–ª—å–∫–æ –∏–∫–æ–Ω–∫–∞ –≤–æ–ª–∫–∞, –±–µ–∑ —Ç–µ–∫—Å—Ç–∞) - –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    # –°–æ–∑–¥–∞–µ–º –∫–≤–∞–¥—Ä–∞—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é –¥–ª—è favicon/–∏–∫–æ–Ω–æ–∫
    ICON="logo-$i-icon.png"

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —á—Ç–æ –æ–±—Ä–µ–∑–∞—Ç—å –¥–ª—è –∏–∫–æ–Ω–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞
    if [ "$i" -eq 3 ]; then
        # logo-3 - –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π, –±–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ö–Ω—é—é —á–∞—Å—Ç—å (—â–∏—Ç)
        magick "$PADDED" -gravity North -crop 100%x65%+0+0 +repage -resize 512x512 "$ICON"
    else
        # logo-1 –∏ logo-2 - –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ, –±–µ—Ä–µ–º –ª–µ–≤—É—é —á–∞—Å—Ç—å (–∏–∫–æ–Ω–∫–∞)
        magick "$PADDED" -gravity West -crop 30%x100%+0+0 +repage -resize 512x512 "$ICON"
    fi

    # Favicon sizes (–æ—Ç –∏–∫–æ–Ω–∫–∏)
    magick "$ICON" -resize 16x16 "favicon-$i-16.png"
    magick "$ICON" -resize 32x32 "favicon-$i-32.png"
    magick "$ICON" -resize 192x192 "favicon-$i-192.png"
    magick "$ICON" -resize 512x512 "favicon-$i-512.png"

    # –õ–æ–≥–æ—Ç–∏–ø—ã –¥–ª—è —Å–∞–π—Ç–∞ (–ø–æ–ª–Ω—ã–µ —Å —Ç–µ–∫—Å—Ç–æ–º)
    magick "$PADDED" -resize 256x "logo-$i-256.png"
    magick "$PADDED" -resize 128x "logo-$i-128.png"
    magick "$PADDED" -resize 64x "logo-$i-64.png"

    # –ü–æ–ª–Ω–æ—Ä–∞–∑–º–µ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è
    cp "$PADDED" "logo-$i-full.png"

    echo "   ‚úÖ –°–æ–∑–¥–∞–Ω–æ: cropped, padded, icon, + —Ä–∞–∑–º–µ—Ä—ã"
    echo ""
done

echo "üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤:"
echo ""
echo "–û—Ä–∏–≥–∏–Ω–∞–ª—ã:"
ls -lh logo-1.png logo-2.png logo-3.png 2>/dev/null | awk '{print "  " $9 ": " $5}'

echo ""
echo "–û–±—Ä–µ–∑–∞–Ω–Ω—ã–µ —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏:"
ls -lh logo-*-padded.png 2>/dev/null | awk '{print "  " $9 ": " $5}'

echo ""
echo "–ò–∫–æ–Ω–∫–∏ (512x512):"
ls -lh logo-*-icon.png 2>/dev/null | awk '{print "  " $9 ": " $5}'

echo ""
echo "–†–∞–∑–º–µ—Ä—ã –¥–ª—è —Å–∞–π—Ç–∞:"
ls -lh logo-*-256.png logo-*-128.png logo-*-64.png 2>/dev/null | awk '{print "  " $9 ": " $5}'

echo ""
echo "‚ú® –û–±—Ä–µ–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:"
echo ""
echo "–î–ª—è –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–û–ì–û –ª–æ–≥–æ—Ç–∏–ø–∞ (header, footer):"
echo "  - –ò—Å–ø–æ–ª—å–∑—É–π logo-2 (—Å–∞–º—ã–π –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π)"
echo "  - –§–∞–π–ª: logo-2-padded.png –∏–ª–∏ logo-2-128.png"
echo ""
echo "–î–ª—è –ò–ö–û–ù–ö–ò/FAVICON:"
echo "  - –ò—Å–ø–æ–ª—å–∑—É–π logo-3-icon.png (–±–æ–ª—å—à–æ–π –¥–µ—Ç–∞–ª—å–Ω—ã–π —â–∏—Ç)"
echo "  - –ò–ª–∏ logo-2-icon.png (–ø—Ä–æ—Å—Ç–∞—è –∏–∫–æ–Ω–∫–∞)"
echo ""
echo "–î–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π (–∫–≤–∞–¥—Ä–∞—Ç):"
echo "  - logo-3-icon.png (512x512)"
echo ""
